<div class="sidebar" id="sidebar">
  <div class="toggle-btn" id="toggleSidebar">
    <i class="fas fa-bars"></i>
  </div>

  <a href="/">
    <img src="/static/logo.png" alt="Logo" class="logo">
  </a>

  <div class="menu-section">
    <a class="nav-link" href="/diagnose" data-page="diagnose">
      <i class="fas fa-stethoscope"></i>
      <span class="nav-text">Medical Image Diagnosis</span>
    </a>
    <a class="nav-link" href="/vision-qa" data-page="vision-qa">
      <i class="fas fa-circle-question"></i>
      <span class="nav-text">Medical Vision Q&A</span>
    </a>
    <a class="nav-link" href="/history" data-page="history">
      <i class="fas fa-clock"></i>
      <span class="nav-text">History & Statistics</span>
    </a>
    {% if isDoctor %}
    <a class="nav-link" href="/pending-cases" data-page="pending-cases">
      <i class="fas fa-hourglass-half"></i>
      <span class="nav-text">Pending Cases</span>
    </a>
    {% endif %}
    <a class="nav-link" href="/shared-to-me" data-page="shared-to-me">
      <i class="fas fa-share-nodes"></i>
      <span class="nav-text">Shared to Me</span>
    </a>
    {% if show_patient_management %}
    <!-- New Patient Management Menu -->
    <a class="nav-link" href="/patient-management" data-page="patient-management">
      <i class="fas fa-users"></i>
      <span class="nav-text">Patient Management</span>
    </a>
    {% endif %}
  </div>

  <div class="menu-section menu-bottom">
    <!-- Notifications -->
    <a class="nav-link position-relative" href="#" data-bs-toggle="modal" data-bs-target="#notificationsModal">
      <i class="fas fa-bell"></i>
      <span class="nav-text ms-2">Notifications</span>
      {% if notifications|length > 0 %}
        <span class="badge bg-danger">{{ notifications|length }}</span>
      {% endif %}
    </a>

    <!-- Language Dropdown -->
    <div class="dropdown w-100 mt-2">
      <a class="dropdown-toggle d-flex align-items-center nav-link" href="#" id="langToggle" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false">
        <i class="fas fa-flag"></i>
        <span class="nav-text ms-2">Language</span>
      </a>
      <ul class="dropdown-menu language-dropdown" aria-labelledby="langToggle">
        <li><a class="dropdown-item language-item" href="#" data-lang="en"><i class="fas fa-flag-usa"></i> English</a></li>
        <li><a class="dropdown-item language-item" href="#" data-lang="vi"><i class="fas fa-flag"></i> Vietnamese</a></li>
      </ul>
    </div>

    <!-- Profile Dropdown -->
    <div class="dropdown w-100 mt-2">
      <a class="dropdown-toggle d-flex align-items-center nav-link" href="#" id="profileToggle" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false">
        <i class="fas fa-user"></i>
        <span class="nav-text ms-2">Profile</span>
      </a>
      <ul class="dropdown-menu profile-dropdown" aria-labelledby="profileToggle">
        <li><a class="dropdown-item" href="/profile">Profile</a></li>
        <li><a class="dropdown-item" href="/logout">Logout</a></li>
      </ul>
    </div>
  </div>
</div>

<!-- Notifications Modal -->
<div class="modal fade" id="notificationsModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Notifications</h5></div>
      <div class="modal-body">
        {% if notifications and notifications|length > 0 %}
          {% for n in notifications %}
            <div class="alert alert-info d-flex justify-content-between align-items-center" id="notif-{{n.id}}">
              <div>
                <strong>Bác sĩ {{ n.user_id }}</strong> đã chia sẻ chẩn đoán cho bạn.<br>
                <small>{{ n.timestamp }}</small>
              </div>
              <div>
                <button class="btn btn-success btn-sm me-2" onclick="respondShare({{ n.id }}, {{ n.type }}, 1)">Chấp nhận</button>
                <button class="btn btn-danger btn-sm" onclick="respondShare({{ n.id }}, {{ n.type }}, 2)">Từ chối</button>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <p>No new notifications.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% if isDoctor %}
<style>
  .sidebar {
    background: linear-gradient(180deg,#16a085,#1e3c72);
  }
  .text-primary {
    color: #1e3c72 !important;
  }
  .btn-primary {
    border-color: #1e3c72 !important;
    background: #1e3c72 !important;
  }
</style>
  
{% endif %}